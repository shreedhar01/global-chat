name: Discord Notification

on:
  workflow_call:
    inputs:
      status:
        required: true
        type: string
      job-name:
        required: true
        type: string
      commit-message:
        required: true
        type: string
      author:
        required: true
        type: string
      timestamp:
        required: true
        type: string
    secrets:
      DISCORD_WEBHOOK_URL:
        required: true

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          # Check if webhook URL exists
          if [ -z "$WEBHOOK_URL" ]; then
            echo "⚠️ DISCORD_WEBHOOK_URL is empty. Skipping notification."
            exit 0
          fi

          # Set color based on status
          COLOR=3066993  # Green for success
          if [ "${{ inputs.status }}" != "success" ]; then
            COLOR=15158332  # Red for failure
          fi

          # Send notification
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{
            \"embeds\": [{
              \"title\": \"${{ inputs.job-name }} Deployment: ${{ inputs.status }}\",
              \"color\": ${COLOR},
              \"fields\": [
                {\"name\": \"Commit\", \"value\": \"${{ inputs.commit-message }}\", \"inline\": false},
                {\"name\": \"Author\", \"value\": \"${{ inputs.author }}\", \"inline\": true},
                {\"name\": \"Timestamp\", \"value\": \"${{ inputs.timestamp }}\", \"inline\": true}
              ],
              \"footer\": {\"text\": \"GitHub Actions CI/CD\"},
              \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
            }]
          }" "$WEBHOOK_URL"
